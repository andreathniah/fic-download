<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>test</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/normalize.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
</head>
    
<body>
    <div class="container">
        <div class="row">
            <form>
                <input class="nine columns u-full-width" type="text" placeholder="URL" id="urlInput">
                <input class="button three columns u-pull-right" type="submit" value="Submit" onclick="storeURL()">
            </form>
        </div>
        <div class="row" id="technicalReport">
            <p><strong>Technical Report</strong></p>
            <p>Limitations known:</p>
            <ul>
                <li>Support on .epub and .mobi only available via Calibre package's ebook-convert utility, which requires a server</li>
                <li>
                    Cross-origin resource sharing (CORS) have to be disabled on client's browser end.
                    <ul>
                        <li><strong>Alternative:</strong> migrate to server - probably with node.js</li>
                    </ul>
                </li>
                <li>
                    Formatting error with jsPDF library. It does not parse UTF-8 properly
                    <ul>
                        <li><strong>Alternative:</strong> open window.print() dialogue and get user to save PDF from that end (dependent on which browser users use) </li>
                    </ul>
                </li>
            </ul>
            <p>To-do List:</p>
            <ul>
                <li>Add IE support for XMLHttpRequest</li>
                <li>
                    CSS refurbishment
                    <ul>
                        <li>Create a proper loading gif icon</li>
                    </ul>
                </li>
                <li>
                    Support for other fanfiction websites
                    <ul>
                        <li>Validate which website</li>
                    </ul>
                </li>
                <li>Support for other ebooks formats</li>
                <li>Hyperlink for content page</li>
            </ul>
        
        </div>
    </div>
</body>

<script>
    $(function() {
        var alertMessage = "Please disable CORS with plugin available at https://goo.gl/hjm68i to use this service. This limitation will cease once we migrate to a server!";
//        alert(alertMessage);
    });
    
    function storeURL() {
        var urlValue, typeURL, domain;
        
        if (typeof(Storage) !== "undefined") {
            urlValue = document.getElementById("urlInput").value;
            localStorage.setItem("urlInput", urlValue);            
            
            // convert to lowercase
            urlValue = urlValue.toLowerCase();
            
            typeURL = determineType(urlValue);
            switch (typeURL) {
                case 0: window.open("fanfictionNet.html", "_blank");
                    break;
                case 1: window.open("asianFanfiction.html", "_blank");
                    break;
                default: 
                    domain = getDomain(urlValue);
                    alert(domain + " is not supported.");
            }
            
            document.getElementById("urlInput").value = "";
        }
        else {
            alert("Browser not compatible with localStorage");
        }
    }
    
    function determineType(urlString) {
        var searchString = ["fanfiction.net", "asianfanfics"] 
        
        for (i=0; i<searchString.length; i++) {
            if (urlString.search(searchString[i]) != -1) {
                return i;
            }
        }
    }
    
    function getDomain(urlString) {
        var urlArray = urlString.split("/");     
        return urlArray[2].toString();
    }
    
</script>
</html>

